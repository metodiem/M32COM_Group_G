@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<script src="~/Scripts/jquery-3.3.1.js" type="text/javascript"></script>

@{
    ViewBag.Title = "Teams";
}
<div class="container-fluid">
    <div class="row">
        <div class="col-lg-6">

            <h2 id="teamName"></h2>
            <dl>
                <dt>Members:</dt>
                <dd><p id="name"></p></dd>
            </dl>

            <div class="form-group">
                <label for="email">Invite someone to join your team:</label>
                <input type="text" placeholder="Email" class="form-control" id="email">
                <button onclick="sendRequest()">Add</button>
                <p id="sendInvite"></p>
            </div>

            <div class="invitation">

               
                <div id="invite">
                    <h2>Invites:  </h2>
                    <div class="invite-form">
                        <button onclick="accept()">Accept</button>
                        <button onclick="decline()">Decline</button>
                        <p id="inviteStatus"></p>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-lg-6">
            <h2>Boat</h2>
            <div id="mdlshow">
                <table class="table table-bordered">
                    <thead>
                        <tr></tr>
                    </thead>
                    <tbody>
                        <tr>
                            <th scope="row">Model</th>
                            <td id="boatModel"></td>
                        </tr>
                        <tr>
                            <th scope="row">Year</th>
                            <td id="boatYear"></td>
                        </tr>
                    </tbody>
                </table>
            </div>

            
            
            
            <div id="mdl">
                <div class="model-form">
                    <label for="email">Add one now:</label>
                    <input type="text" placeholder="model" class="form-control" id="model">

                    <input type="text" placeholder="year" class="form-control" id="year">
                    <button onclick="sendRequestBoat()">Add</button>

                </div>
                <p id="boatstatus"></p>
            </div>
            
        </div>
    </div>
</div>



<script>

    token = "Bearer 28M1Qr7JIgiX3XcnaAQQQXEoOW1cc1B7E4UhxhBeP4l9h3A8CWqTnaWAWl2tI05Cpdf2I3700zm4cX5fsVMaH2RGXW3IuV/Cx4CRRh8fayaOWL9/YRpOQr0aELB40RZB9fQ192xvD4c6V/K6scQjHAjT8Sw0KdyyVRRPIgVIqia3mD+D1hGpUC68ytYcg8CH+I+IoH7iktHiqAWrXVQpdg==";
    $.ajax({
        url: 'http://localhost:52082/api/team/members',
        type: 'GET',
        headers: { "Authorization": token },
        dataType: 'json',
        success: function (data, textStatus, xhr) {
            console.log(data);

            var usr = data.result;

            console.log(usr[0]);
            $("#name").text(usr[0].name + " " + usr[0].surname);
            $("#teamName").text(usr[0].teamName);

        },
        error: function (xhr, textStatus, errorThrown) {
            console.log('Error in Operation');
        }
    });


    function getBoats() {
        $.ajax({
            url: 'http://localhost:52082/api/team/get/boat',
            type: 'GET',
            headers: { "Authorization": token },
            dataType: 'json',
            success: function (data, textStatus, xhr) {
                console.log(data);
                if (data.result !== null) {
                    document.getElementById("mdlshow").style.display = "inline";
                    document.getElementById("boatModel").innerHTML = data.result.model;
                    document.getElementById("boatYear").innerHTML = data.result.year;
                    if (data.hasError == false) {
                        document.getElementById("mdl").style.display = "none";
                    }



                } else {

                    document.getElementById("mdlshow").style.display = "none";

                }

            },
            error: function (xhr, textStatus, errorThrown) {
                console.log('Error in Operation');
            }
        });
    }
    getBoats();






</script>

<script>
    function sendRequest() {
        var email = {
            email : document.getElementById("email").value
        }
        var jsonText = JSON.stringify(email);
        
        console.log(jsonText);
        token = "Bearer tiglaecOjPNyUH6UFeTA0lssKlK4qp5Uu5muQRLX4i2BR3gW3UvQACi1JPz6Qe26ni1iFyDv7MNfVpRZwmMCbTFuxZznlms3htJuf7LR7KzEi/P0zXnNE4ysALUpipsCGXZEnWu1VuccYM7o7oqdAwm8NiUHDYaoIVCWXKuyYYpuTefPmvjncCDRM0L3j3Nbf9/UpfaS/te8gNh7wVghAQ==";
        $.ajax({
            url: 'http://localhost:52082/api/team/invite',
            type: 'POST',
            headers: { "Authorization": token  },
            contentType: 'application/json',
            data: jsonText,
            processData: false,
            dataType: 'json',
            success: function (data, textStatus, xhr) {
                console.log(data);
                var invite = data.message;
                console.log(invite);
                document.getElementById("SendInvite").innerHTML = invite;
                

            },
            error: function (xhr, textStatus, errorThrown) {
                console.log('Error in Operation');
            }
        });
    }

</script>

<script>
    function sendRequestBoat() {
        var boat = {
            model: document.getElementById("model").value,
            year: document.getElementById("year").value
           
        }
        var jsonText = JSON.stringify(boat);

        console.log(jsonText);
        var divform = document.getElementById("mdl");
        token = "Bearer tiglaecOjPNyUH6UFeTA0lssKlK4qp5Uu5muQRLX4i2BR3gW3UvQACi1JPz6Qe26ni1iFyDv7MNfVpRZwmMCbTFuxZznlms3htJuf7LR7KzEi/P0zXnNE4ysALUpipsCGXZEnWu1VuccYM7o7oqdAwm8NiUHDYaoIVCWXKuyYYpuTefPmvjncCDRM0L3j3Nbf9/UpfaS/te8gNh7wVghAQ==";
        $.ajax({
            url: 'http://localhost:52082/api/team/addboat',
            type: 'POST',
            headers: { "Authorization": token },
            contentType: 'application/json',
            data: jsonText,
            processData: false,
            dataType: 'json',
            complete: function (data, textStatus, xhr) {
                var bt = data.responseJSON;
                console.log(data);
                console.log(bt.hasError);
                document.getElementById("boatstatus").innerHTML = bt.message;
                if (bt.hasError == false) {

                    divform.style.display = 'none';
                    document.getElementById("mdlshow").style.display = "inline";
                    
                   
                }

            },
            error: function (xhr, textStatus, errorThrown) {
                console.log('Error in Operation');
            }
        });
        getBoats();
    }
    

</script>

<script>
    token = "Bearer bM/6qh5pKLs+9KZQwT/DgDy9kVRPTQWb3NU4b89AckkOVjULv/8d0iKxHV2ODpZ3d1+MH2VBKJGOR87YYn5C7/R3bYKdmWkSfIJLtxC/a2uFFpjrIf/dWgKxmdXtDAUfvTnR9rkmPm0+IT21HETdNct69JabUrNIdywiobG4CN97zqBIPnpOFG3H3Xsvtb6HYxXN6m/oFK7DHlqR3NE8Hw==";
    var usr;
    $.ajax({
        url: 'http://localhost:52082/api/notification/all',
        type: 'GET',
        headers: { "Authorization": token },
        dataType: 'json',
        success: function (data, textStatus, xhr) {
            console.log(data);
            usr = data.result;

            if (usr.length !== 0) {

                document.getElementById("invite").style.display = "inline";
                document.getElementById("invite").innerHTML = usr[0].description;
            } else {
                document.getElementById("invite").style.display = "none";
            }
            // $("#name").text(usr[0].name + " " + usr[0].surname);
            // $("#teamName").text(usr[0].teamName);
        },
        error: function (xhr, textStatus, errorThrown) {

            console.log('Error in Operation');
        }
    });
    function accept() {
        token = "Bearer bM/6qh5pKLs+9KZQwT/DgDy9kVRPTQWb3NU4b89AckkOVjULv/8d0iKxHV2ODpZ3d1+MH2VBKJGOR87YYn5C7/R3bYKdmWkSfIJLtxC/a2uFFpjrIf/dWgKxmdXtDAUfvTnR9rkmPm0+IT21HETdNct69JabUrNIdywiobG4CN97zqBIPnpOFG3H3Xsvtb6HYxXN6m/oFK7DHlqR3NE8Hw==";
        var actionToken = usr[0].actionToken;
        $.ajax({
            url: 'http://localhost:52082/api/team/respondinvitation/true',
            type: 'GET',
            headers: { "Authorization": token, "actionToken": actionToken },
            dataType: 'json',
            success: function (data, textStatus, xhr) {
                console.log(data);
                var usr = data.result;

                if (data.hasError !== True) {
                    document.getElementById("inviteStatus").innerHTML = data.message;

                } else {
                }
                // $("#name").text(usr[0].name + " " + usr[0].surname);
                // $("#teamName").text(usr[0].teamName);
            },
            error: function (xhr, textStatus, errorThrown) {

                console.log('Error in Operation');
            }
        });

    }





</script>







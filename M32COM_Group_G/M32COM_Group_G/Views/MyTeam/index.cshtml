@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<script src="~/Scripts/jquery-3.3.1.js" type="text/javascript"></script>

@{
    ViewBag.Title = "Teams";
}



<div class="container-fluid">
    <div class="row">
        <div class="col-lg-6">

            <h2 id="teamName"></h2>
            <table class="table table-bordered">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Surname</th>
                    </tr>
                </thead>
                <tbody id="memberData">
                </tbody>
            </table>


            <div class="form-group">
                <label for="email">Invite someone to join your team:</label>
                <input type="text" placeholder="Email" class="form-control" id="email">
                <button onclick="sendRequest()">Add</button>
                <p id="sendInvite"></p>
            </div>

            
        </div>
        <div class="col-lg-6">
            <h2>Boat</h2>
            <div id="mdlshow">
                <table class="table table-bordered">
                    <thead>
                        <tr></tr>
                    </thead>
                    <tbody>
                        <tr>
                            <th scope="row">Model</th>
                            <td id="boatModel"></td>
                        </tr>
                        <tr>
                            <th scope="row">Year</th>
                            <td id="boatYear"></td>
                        </tr>
                    </tbody>
                </table>
            </div>

            
            
            
            <div id="mdl">
                <div class="model-form">
                    <label >Add one now:</label>
                    <input type="text" placeholder="model" class="form-control" id="model">

                    <input type="text" placeholder="year" class="form-control" id="year">
                    <button onclick="sendRequestBoat()">Add</button>

                </div>
                <p id="boatstatus"></p>
            </div>
            
        </div>
    </div>
</div>



<script>
    
    
    var token = sessionStorage.getItem("token");
    token = "Bearer " + token;
    $.ajax({
        url: 'http://localhost:52082/api/team/members',
        type: 'GET',
        headers: { "Authorization": token },
        dataType: 'json',
        success: function (data, textStatus, xhr) {
            

            var usr = data.result;
            var k = '<tbody>';
            for (i in usr) {
                k += "<tr>";
                k += ("<td>" + usr[i].name + "</td");
                k += "<td>" + "</td>";
                k += ("<td>" + usr[i].surname + "</td");
                k += "</tr>";
            }
            k += "</tbody>";
            document.getElementById("memberData").innerHTML = k;
            //console.log(data);
            document.getElementById("teamName").innerHTML = usr[0].teamName;
            
            //$("#name").text(usr[0].name + " " + usr[0].surname);
            //$("#teamName").text(usr[0].teamName);

        },
        error: function (xhr, textStatus, errorThrown) {
         // console.log('Error in Operation');
        }
    });


    function getBoats() {
        $.ajax({
            url: 'http://localhost:52082/api/team/get/boat',
            type: 'GET',
            headers: { "Authorization": token },
            dataType: 'json',
            success: function (data, textStatus, xhr) {
                console.log(data);
                if (data.result !== null) {
                    document.getElementById("mdlshow").style.display = "inline";
                    document.getElementById("boatModel").innerHTML = data.result.model;
                    document.getElementById("boatYear").innerHTML = data.result.year;
                    if (data.hasError == false) {
                        document.getElementById("mdl").style.display = "none";
                    }



                } else {

                    document.getElementById("mdlshow").style.display = "none";

                }

            },
            error: function (xhr, textStatus, errorThrown) {
                console.log('Error in Operation');
            }
        });
    }
    getBoats();






</script>

<script>
    function sendRequest() {
        var email = {
            email : document.getElementById("email").value
        }
        var jsonText = JSON.stringify(email);
        var tokn = sessionStorage.getItem("token");
        token = "Bearer " + tokn;
        console.log(jsonText);
        $.ajax({
            url: 'http://localhost:52082/api/team/invite',
            type: 'POST',
            headers: { "Authorization": token },
            contentType: 'application/json',
            data: jsonText,
            processData: false,
            dataType: 'json',
            complete: function (data, textStatus, xhr) {
                console.log(data.responseJSON.message);
                document.getElementById("sendInvite").innerHTML = data.responseJSON.message;
                
                //var invite = data.message;
                //console.log(invite);
                //document.getElementById("SendInvite").innerHTML = invite;
                

            },
            error: function (xhr, textStatus, errorThrown) {
                //console.log(errorThrown);
               // console.log('Error in Operation');
            }
        });
    }

</script>

<script>
    function sendRequestBoat() {
        var boat = {
            model: document.getElementById("model").value,
            year: document.getElementById("year").value
           
        }
        var jsonText = JSON.stringify(boat);

        console.log(jsonText);
        var divform = document.getElementById("mdl");
        token = ("Bearer " + sessionStorage.getItem(token));
        $.ajax({
            url: 'http://localhost:52082/api/team/addboat',
            type: 'POST',
            headers: { "Authorization": token },
            contentType: 'application/json',
            data: jsonText,
            processData: false,
            dataType: 'json',
            complete: function (data, textStatus, xhr) {
                var bt = data.responseJSON;
                console.log(data);
                console.log(bt.hasError);
                document.getElementById("boatstatus").innerHTML = bt.message;
                if (bt.hasError == false) {

                    divform.style.display = 'none';
                    document.getElementById("mdlshow").style.display = "inline";
                    
                   
                }

            },
            error: function (xhr, textStatus, errorThrown) {
                console.log('Error in Operation');
            }
        });
        getBoats();
    }
    

</script>








